<!doctype html>
<html>
  <meta charset="utf-8" />
  <title>Beat Rail - Box Gate (Updated Visual)</title>
  <style>
    /* Fixed-width mono to keep geometry stable */
    body {
      font: 24px/1.3 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      margin: 0;
      padding: 24px;
    }

    .track {
      position: relative;
      height: 2.0em;
      overflow: hidden;
      border: 1px solid #ddd;
      border-radius: 10px;
      background-size: 40px 40px;
      background-position: 0 0;
      user-select: none;
    }

    /* Updated BOX gate on the left (smaller + thinner outline) */
    #gateBox {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      left: 10%;
      width: 2.2ch;          /* narrower box window */
      height: 1.2em;         /* slightly shorter height */
      border: 1px solid #4aa3ff; /* thinner outline */
      border-radius: 6px;
      background: rgba(74,163,255,0.02);
      box-shadow: 0 0 0 1px rgba(74,163,255,.12) inset;
      z-index: 3;
      pointer-events: none;
    }

    /* Stationary preview phrase rendered INSIDE the track */
    #line {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      gap: 0.45ch;
      padding-inline: 24px;   /* shared measurement context for JS */
      z-index: 1;
      will-change: transform; /* JS translates this (not every frame) */
    }
    .word { display: inline-flex; gap: 0.1ch; opacity: 0.9; }
    .word.active { opacity: 1; font-weight: 600; }
    .ch { display: inline-block; width: 1ch; text-align: center; }

    /* Hidden = permanently removed after hit; ghost = hidden only during the active window */
    .ch.hidden, .ch.ghost { visibility: hidden; }

    /* The ONLY moving glyph (the flyer) */
    #fly {
      position: absolute;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 1ch;
      text-align: center;
      z-index: 4;
      pointer-events: none;
    }

    #feedback { height: 1.3em; margin-top: 0.6em; }
  </style>

  <div class="track" id="track">
    <div id="gateBox"></div>
    <div id="line" aria-live="polite"></div>
    <div id="fly"></div>
  </div>

  <div id="feedback"></div>

  <script type="module" src="src/rail.ts"></script>
</html>
